(function() {

"use strict";

angular.module("BitriseWorkflowEditor").controller("SecretsController", function(requestService, communicationHelper, Progress, Variable) {

	var viewModel = this;

	viewModel.secrets;
	var savedSecrets;

	viewModel.loadSecretsProgress = new Progress();
	viewModel.loadTemplateProgress = new Progress();

	function loadSecrets() {
		viewModel.loadSecretsProgress.start("<%= data[:strings][:secrets][:loading] %>");

		requestService.getSecrets().then(function(secretConfigs) {
			viewModel.secrets = _.map(secretConfigs, Variable.createFromVariableConfig);
			savedSecrets = angular.copy(viewModel.secrets);

			viewModel.loadSecretsProgress.success();

			communicationHelper.addMessage("configureEnvVarsController", {
				source: "secrets",
				envVars: viewModel.secrets
			});
		}, function(error) {
			viewModel.loadSecretsProgress.error(error);
		});
	}

	loadSecrets();

	viewModel.loadTemplateProgress.start("<%= data[:strings][:env_var_editor][:template_load_inprogress] %>");

});

})();
