(function() {

"use strict";

angular.module("BitriseWorkflowEditor").controller("YMLController", function($rootScope, requestService, Progress) {

	var viewModel = this;

	viewModel.appConfigYML;
	var savedAppConfigYML;
	viewModel.loadAppConfigYMLProgress = new Progress();
	viewModel.downloadAppConfigYMLPath = requestService.mode == "website" ? requestService.appConfigYMLDownloadPath() : null;

	function loadAppConfigYML() {
		viewModel.loadAppConfigYMLProgress.start("<%= data[:strings][:yml][:load_progress][:loading] %>");

		requestService.getAppConfigYML().then(function(appConfigYML) {
			viewModel.appConfigYML = appConfigYML;
			savedAppConfigYML = appConfigYML;

			viewModel.loadAppConfigYMLProgress.success();
		}, function(error) {
			viewModel.loadAppConfigYMLProgress.error(error);
		});
	}

	$rootScope.$on("MainController::discardChanges", function() {
		viewModel.appConfigYML = savedAppConfigYML;
	});

	loadAppConfigYML();

});

})();
