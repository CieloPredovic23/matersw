(function() {
	"use strict";

	angular
		.module("BitriseWorkflowEditor")
		.controller("LicensesController", function(
			appService,
			Workflow,
			$scope,
			$rootScope,
		) {
			var viewModel = this;

			$scope.licenses = [
				{
					id: null,
					name: '(No license pool selected)',
				},
				{
				id: 1,
				name: 'aLabel',
			}, {
				id: 2,
				name: 'bLabel',
			}];

			viewModel.workflowLicenseFactory = function(workflow) {

				return function(licensePoolOption) {
					if(licensePoolOption !== undefined) {
						workflow.licensePoolId(licensePoolOption.id)
					}

					var id = workflow.licensePoolId();

					if(id) {
						var licenseOption = $scope.licenses.find((item) => {
							if(item.id === id) {
								return true
							}
						})

						return licenseOption;
					}

					return $scope.licenses[0];
				}
			}

			$rootScope.$on('MainController::changesDiscarded', function() {
				viewModel.workflows = mapWorkflows();
			})

			function mapWorkflows() {
				return _.map(appService.appConfig.workflows, function(
					aWorkflowConfig,
					workflowID
				) {
					return new Workflow(workflowID, aWorkflowConfig);
				});
			}

			// Setup workflows
			viewModel.workflows = mapWorkflows();
    })

})();
