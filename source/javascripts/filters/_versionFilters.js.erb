"use strict";

angular.module("BitriseWorkflowEditor").filter("wildcardVersions", ["stepSourceService", function(stepSourceService) {
    var shouldInsertLatest = function(step) {
        return step.isLibraryStep();
    };

    var stepVersions = function(step) {
        var wildcardVersions = stepSourceService.versionsOfStep(step);

        // inserts step version and remove duplication
        return _.union(wildcardVersions, [step.version]);
    };

    return function(step) {
        var versions = stepVersions(step);

        if (shouldInsertLatest(step) && !_.contains(versions, null)) {
            return [null].concat(versions);
        }

        return versions;
    };
}]);
