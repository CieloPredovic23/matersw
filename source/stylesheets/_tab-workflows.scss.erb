@import "default";
@import "constants";

.tab-workflows .content {
  overflow: hidden;
}

.workflows-container {
  display: flex;
  flex-direction: row;
  overflow: hidden;
  flex: 1;
}

.flex-row-container {
  display: flex;
  flex-direction: row;
}

.Placement .Placement__content .Placement__area-content .DropdownMenu__content {
  .DropdownMenu__item {
    .Visibility {
      width: 12px;
    }

    &:nth-child(2) {
      svg.Base.Icon:last-child {
        transform: scaleY(-1);
      }
    }

    &:nth-child(3) {
      svg.Base.Icon:last-child {
        transform: rotate(90deg);
      }
    }

    &:last-child {
      color: var(--color-red--3);

      &:hover {
        color: var(--color-red--4);
        background-color: var(--color-red--1);
      }
    }
  }
}

section.manage-workflows {
  $button-spacing: 8px;
  $button-wrapping-point: 580px;

  @include flex-shrink(0);
  @include display-flex;
  @include flex-wrap(wrap);
  padding: #{$main-verticalpadding - ($button-spacing / 2)} #{$main-horizontalpadding - ($button-spacing / 2)};
  background-color: white;

  .react-toolbar {
    flex-grow: 1;
  }

  [aria-label='Add new Workflow'] {
    padding: 11px;
  }

  [aria-label='Manage Workflows'] {
    padding: 11px;

    svg.Base.Icon {
      margin: 0;

      &:last-child {
        display: none;
      }
    }
  }

  &:not(.ninja) > * {
    margin: $button-spacing / 2;
  }

  button.manage-button {
    font-size: 14px;
  }

  button.add-workflow, button.add-before-run-workflow, button.add-after-run-workflow, button.rearrange, button.delete-workflow {
    @include flex-grow(1);

    svg:last-of-type {
      margin-right: 8px;
    }

    @include media-below-mid {

      svg:last-of-type {
        margin-right: 0;
      }

      span {
        display: none;
      }
    }
  }

  button.add-workflow {

    svg {
      @include size(10px);
    }
  }

  button.add-before-run-workflow {

    svg {
      @include size(10px, 10px);
    }
  }

  button.add-after-run-workflow {

    svg {
      @include size(10px, 10px);
    }
  }

  button.rearrange {

    svg {
      @include size(8px, 13px);
    }

    svg:first-of-type {
      @include transform(rotate(180deg));
    }
  }

  button.delete-workflow {

    svg {
      @include size(24px);
      margin-top: -4px;
      margin-bottom: -7px;
    }

    svg:last-of-type {
      margin-right: 0;
    }
  }

  @include media-below-mid {
    @include padding-x($main-horizontalpadding_small - ($button-spacing / 2));
  }
}

.tab-workflows {
  @include flex-grow(1);
  @include flex-shrink(0);
  @include display-flex;
  @include flex-direction(column);

  p.progress-indicator {
    margin: $main-verticalpadding $main-horizontalpadding;

    @include media-below-mid {
      @include margin-x($main-horizontalpadding_small);
    }
  }

  .content {
    @include flex-grow(1);
    @include flex-shrink(0);
    @include display-flex;
    @include flex-direction(column);

    .workflows {
      $spacing: 8px;
      $icon-size: 52px;
      $icon-size_small: 36px;
      $steptitle-width: 280px;
      $steptitle-width_small: 220px;
      border-top: 1px solid $def-lightgrey;

      @include flex-grow(1);
      @include flex-shrink(0);
      @include display-flex;
      @include flex-direction(column);
      background-color: $def-ultralightgrey;

      .steps-container {
        border-right: 1px solid $def-lightgrey;
        overflow-y: auto;
        background: #ffffff;
      }

      .step-edit-container {
        flex: 1;
        overflow-y: auto;
        background: white;
      }

      section.workflow {
        @include flex-shrink(0);
        @include padding-x($main-horizontalpadding);
        @include transition(background-color $def-transition_duration);

        &:not(:first-child) {
          border-top: 1px dashed $def-grey;
        }

        &:last-child {
          @include flex-grow(1);
        }

        header.workflow-header {
          @include display-flex;
          margin-bottom: $spacing;

          .header-info {
            @include flex-grow(1);
            @include align-self(flex-end);
            @include display-flex;
            @include align-items(center);
            margin-left: $spacing;

            h2 {
              $color: $def-mediumdarkgrey;

              @include flex-grow(1);
              @include flex-shrink(0);
              position: relative;
              @include display-flex;
              @include align-items(center);
              @include box-sizing(border-box);
              width: 100%;
              max-width: $steptitle-width;
              @include margin-y(0);
              border: 1px solid $color;
              @include border-radius($def-radius);
              overflow: hidden;
              font-size: 16px;
              font-weight: 400;
              color: $color;

              button.edit {
                @include position(absolute, 0, 0);
                @include size(100%);

                &:hover ~ span.icons-and-name, &:focus ~ span.icons-and-name {
                  background-color: white;

                  span.edit-icon {
                    opacity: 1;
                  }
                }
              }

              span.icons-and-name {
                @include flex-grow(1);
                @include display-flex;
                padding: 6px 8px;
                @include ellipsis-oneliner;

                background-color: $def-ultralightgrey;
                @include transition(background-color $def-transition_duration);

                span.icon {
                  display: inline-block;
                  margin-right: 6px;

                  svg {
                    @include size(12px, 11px);
                    fill: $color;
                  }
                }

                span.workflow-name {
                  @include flex-grow(1);
                  @include ellipsis-oneliner;
                }

                span.edit-icon {
                  margin-left: 6px;
                  opacity: 0;
                  @include transition(opacity $def-transition_duration);

                  svg {
                    @include size(12px, 10px);
                    fill: $color;
                  }
                }
              }

              button.remove {
                position: relative;
                @include flex-shrink(0);
                @include align-self(stretch);
                margin-left: auto;
                @include padding-x(4px);
                background-color: $color;
                @include transition(background-color $def-transition_duration);

                svg {
                  display: block;
                  @include size(24px);
                  fill: white;
                }
              }

              button.remove:focus, button.remove:hover {
                background-color: $def-darkgrey;
              }
            }

            .stack {
              @include display-flex;
              @include align-items(center);

              .icon {
                @include flex-shrink(0);
                margin-right: 15px;

                svg {
                  display: block;
                  @include size(16px);
                  fill: $def-darkgrey;
                }
              }

              .name {
                font-size: 16px;
                font-weight: 500;
                color: $def-darkgrey;
              }

              .default-badge {
                $badge-height: 14px;

                @include box-sizing(border-box);
                line-height: $badge-height;
                margin-left: 12px;
                @include border-radius($badge-height / 2);
                @include padding-x(5px);
                font-size: 10px;
                letter-spacing: 0.5px;
                font-weight: 500;
                text-transform: uppercase;
                color: white;
                background-color: $def-blue;
              }
            }
          }
        }

        article {
          $add_step-size: 20px;
          $add_step-iconsize: 12px;
          $add_step-borderwidth: 1px;

          @include display-flex;
          @include align-items(flex-start);

          ul.steps {
            @include align-self(stretch);
            @include display-flex;
            @include flex-direction(column);
            @include margin-y(0);
            margin-right: $spacing;
            padding-left: 0;
            list-style: none;
            @include flex-shrink(0);
            @include transition(opacity $def-transition_duration);

            ul {
              list-style: none;
              padding-left: 0;
            }

            li {
              width: 100%;
              margin-bottom: $spacing;

              button.add-step {
                $transition_duration: $def-transition_duration;

                display: block;
                width: $icon-size;
                margin-bottom: $spacing;
                border: $add_step-borderwidth solid $def-darkgrey;
                @include border-radius($def-radius);
                @include padding-y(($add_step-size - $add_step-iconsize) / 2 - $add_step-borderwidth);
                line-height: $add_step-iconsize;
                @include transition(margin-bottom $transition_duration, border-width $transition_duration, padding-top $transition_duration, padding-bottom $transition_duration, background-color $transition_duration);

                &:before {
                  content: "+";
                  display: block;
                  height: $add_step-iconsize;
                  font-size: 16px;
                  color: $def-darkgrey;
                }
              }

              button.add-step:hover, button.add-step:focus {
                color: white;
                background-color: $def-lightgrey;
              }

              button.add-step:disabled {
                margin-bottom: 0;
                border-width: 0;
                @include padding-y(0);

                &:before {
                  display: none;
                }
              }

              button.add-step:last-child {
                margin-right: $spacing + $steptitle-width;
              }

              .step-actions {
                position: relative;

                button.step {
                  position: relative;
                  text-align: left;

                  img.icon {
                    @include position(absolute, 0, null, null, 0);
                    @include box-sizing(border-box);
                    @include size($icon-size);
                    border: 1px solid $def-lightgrey;
                    @include border-radius($def-box-radius);
                    background-size: cover;
                  }

                  span.info {
                    @include display-flex;
                    @include flex-direction(column);
                    @include justify-content(center);
                    @include align-items(flex-start);
                    @include box-sizing(border-box);
                    @include size($steptitle-width, $icon-size);
                    margin-left: $spacing;
                    border: 1px solid $def-mediumlightgrey;
                    @include border-radius($def-box-radius);
                    @include padding-x(20px);
                    @include transition(border-color $def-transition_duration, color $def-transition_duration, background-color $def-transition_duration);
                    background-color: $def-ultralightgrey;

                    strong {
                      @include display-flex;
                      @include align-items(center);
                      max-width: 100%;
                      font-size: 16px;
                      font-weight: 400;

                      span.title {
                        @include flex-shrink(1);
                        @include ellipsis-oneliner;
                      }

                      .verified, .community-created, .deprecated {
                        margin-left: 5px;
                        @include size(15px);

                        svg {
                          @include size(10px);
                        }
                      }
                    }

                    em.version {
                      display: block;
                      @include ellipsis-oneliner;
                      font-size: 13px;
                      font-style: normal;
                      font-weight: 300;
                      color: $def-darkgrey;

                      @include media-below-big {
                        display: none;
                      }
                    }
                  }
                }

                button.update-step {
                  $size: 14px;
                  border: 1px solid var(--color-white);

                  @include position(absolute, 0, null, null, 52px);
                  @include size($size);
                  margin-top: (- $size / 2) + 3px;
                  margin-left: (- $size / 2) - 3px;
                  @include border-radius($size / 2);
                  background-color: $def-danger;
                  @include transition(background-color $def-transition_duration);

                  box-shadow: 0px 0px 0px 2px white;

                  &:hover, &:focus {
                    background-color: $def-danger-shade;
                  }
                }
              }
            }

            li .step-actions button.step:hover span.info, li .step-actions button.step:focus span.info {
              background-color: $def-verylightgrey;
            }

            li.selected .step-actions button.step span.info {
              $color: $def-darkgrey;

              border-color: $color;
              color: white;
              background-color: $color;

              em.version {
                color: white;
              }
            }
          }

          ul.drag-in-progress li, ul.drag-in-progress + li {

            button.add-step {
              visibility: hidden;
            }
          }

          ul.drag-in-progress li.dragged-element {
            z-index: $zindex-dragged_element;
          }

          aside.selected-step, aside[workflow-description] {
            @include flex-grow(1);
            margin-top: $add_step-size + $spacing;
            margin-bottom: 50px;
          }

          aside.selected-step {
            $trashicon_width: 17px;
            $leftpadding: 25px;
            $rightpadding: ($icon-size - $trashicon_width) / 2 + 3px;
            $horizontalpadding_small: 12px;

            overflow: hidden;

            &:not(.ninja) > * {
              margin-top: 0;
              margin-bottom: 15px;
            }

            .step-details {
              $border: 1px solid $def-mediumlightgrey;

              @include box-sizing(border-box);
              border: $border;
              @include border-radius($def-box-radius);
              overflow: hidden;
              background-color: white;

              header.manage-step {
                @include display-flex;
                @include box-sizing(border-box);
                height: $icon-size;
                border-bottom: $border;
                background-color: $def-verylightgrey;

                .title {
                  @include flex-grow(1);
                  @include display-flex;
                  @include align-items(center);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;
                  overflow: hidden;

                  button.rename {
                    $renamebutton-horizontalpadding: 6px;

                    @include align-self(center);
                    border: 1px solid transparent;
                    @include border-radius($def-radius);
                    margin-left: -$renamebutton-horizontalpadding;
                    padding: 4px $renamebutton-horizontalpadding;
                    text-align: left;
                    @include ellipsis-oneliner;
                    font-size: 16px;
                    font-weight: 400;
                    color: $def-darkgrey;
                    @include transition(border-color $def-transition_duration);
                  }

                  button.rename:hover, button.rename:focus {
                    border-color: $def-grey;
                  }

                  .verified, .community-created, .deprecated {
                    @include flex-shrink(0);
                    @include align-self(center);

                    &:not(:first-of-type) {
                      margin-left: 4px;
                    }

                    svg {
                      display: block;
                      @include size(17px);
                    }
                  }
                }

                .rename-title {
                  @include flex-grow(1);
                  @include display-flex;
                  @include margin-y(0);
                  @include padding-y(6px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;

                  input {
                    width: 60%;
                    border: 1px solid $def-lightgrey;
                    @include border-radius($def-radius);
                    @include padding-x(8px);
                    font-size: 16px;
                  }

                  button.ok {
                    margin-left: 6px;

                    svg {
                      @include size(24px);
                      margin-top: -4px;
                    }
                  }
                }

                aside {
                  @include flex-shrink(0);
                  @include display-flex;

                  button, a {
                    $transition_duration: $def-transition_duration;

                    @include flex-shrink(0);
                    @include box-sizing(border-box);
                    width: $icon-size;
                    line-height: $icon-size;
                    border-left: $border;
                    @include transition(background-color $transition_duration);

                    svg {
                      fill: $def-grey;
                      @include transition(fill $transition_duration);
                    }
                  }

                  button.clone {
                    position: relative;

                    .popover {
                      top: 70%;
                      left: 32%;
                      width: 45px;
                    }

                    svg {
                      @include position(relative, 2px);
                      @include size(18px, 18px);
                    }
                  }

                  a.source {
                    position: relative;
                    text-align: center;

                    .popover {
                      top: 70%;
                      left: 32%;
                      width: 40px;
                    }

                    svg {
                      @include position(relative, 2px);
                      @include size(19px, 19px);
                    }
                  }

                  button.delete svg {
                    @include position(relative, 1px);
                    @include size($trashicon_width, 18px);
                  }

                  button.clone:focus, button.clone:hover, a.source:focus, a.source:hover {

                    svg {
                      fill: $def-verydarkgrey;
                    }
                  }

                  button.delete:focus, button.delete:hover {
                    background-color: $def-danger-light;

                    svg {
                      fill: $def-danger;
                    }
                  }
                }

                @include media-below-big {

                  .title, .rename-title {
                    @include padding-x($horizontalpadding_small);
                  }
                }

                @include media-below-mid {
                  @include flex-direction(column);
                  height: auto;

                  .title, .rename-title {
                    height: $icon-size;
                    border-bottom: $border;
                    @include box-sizing(border-box);
                  }

                  .title {

                    button.rename {
                      font-size: 13px;
                    }
                  }

                  .rename-title input {
                    @include flex-grow(1);
                    font-size: 13px;
                  }

                  aside {
                    $height: 42px;

                    height: $height;

                    button, a {
                      @include flex-grow(1);
                      line-height: $height;
                    }

                    button:first-child, a:first-child {
                      border-left: none;
                    }
                  }
                }
              }

              section.description, section.version {
                @include display-flex;
                @include align-items(center);
                @include justify-content(space-between);
                @include padding-y(18px);
                padding-left: $leftpadding;
                padding-right: $rightpadding;
                font-weight: 300;
                color: $def-darkgrey;

                &:not(:first-of-type) {
                  border-top: $border;
                }

                .version__text {
                  display: inline-block;
                  font-weight: 700;
                  line-height: 2em;
                }

                label.error {
                  color: $def-danger;
                }

                .latest-version {
                  font-size: 13px;
                }

                .icon {
                  display: inline-block;
                  width: 20px;
                  margin-right: 10px;
                  vertical-align: middle;

                  &.icon-ok circle {
                    @include svg-icon($def-green);
                  }

                  &.icon-danger circle {
                    @include svg-icon($def-danger, $def-danger-shade);
                  }
                }

                @include media-below-big {
                  @include padding-x($horizontalpadding_small);
                }

                @include media-below-mid {
                  display: block;
                }
              }

              .version-info {
                flex: 1;
              }

              .version-selector {
                flex: 2;
                text-align: right;

                .remark {
                  display: inline-block;
                  font-size: 13px;
                  margin-right: .5em;
                }

                @include media-below-mid {
                  margin: .5em auto;
                  text-align: initial;

                  select {
                    display: block;
                    margin: 1em auto;
                  }
                }

                label.error {
                  color: $def-danger;
                }
              }

              section.description {
                @include align-items(flex-start);
                position: relative;

                span.icon svg {
                  @include size(16px, 13px);
                  fill: $def-grey;
                }

                .markdown {
                  @include flex-grow(1);
                }

                span.toggle-visibility {
                  z-index: $zindex-step_description_open;
                  @include flex-shrink(0);
                  margin-left: 10px;

                  button {
                    z-index: $zindex-step_description_open;
                    @include position(absolute, 0, 0);
                    @include size(100%);
                    opacity: 0;
                  }

                  svg {
                    position: relative;
                    z-index: -1;
                    @include size(10px, 7px);
                    fill: $def-grey;
                    @include transition(fill $def-transition_duration, transform $def-transition_duration);
                  }

                  button:hover + svg, button:focus + svg {
                    fill: black;
                  }
                }
              }

              section.description.open {

                .markdown {

                  p {
                    margin-top: 0;
                  }

                  pre code {
                    display: block;
                    padding: 6px 10px;
                  }
                }

                span.toggle-visibility {
                  position: relative;

                  svg {
                    @include transform(rotate(-180deg));
                  }
                }
              }

              section.version {
                #selected-step-version-select {
                  min-width: 140px;
                  max-width: 50%;
                  margin-left: auto;
                }
              }

              section.run-if {
                font-size: 13px;
                font-weight: 400;
                color: $def-mediumdarkgrey;

                &:not(:first-of-type) {
                  border-top: $border;
                }

                h3 {
                  @include margin-y(0);
                  border-top: 3px solid $def-lightgrey;
                  @include padding-y(10px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;
                  font-size: 20px;
                  font-weight: 700;
                  color: $def-mediumdarkgrey;
                }

                h5 {
                  @include display-flex();
                  align-items: center;
                  margin-bottom: 8px;
                }

                .run-if-description {
                  margin-bottom: 6px;
                }

                .run-if-details {
                  border-top: 1px solid $def-lightgrey;
                  @include padding-y(18px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;

                  .title {
                    display: block;
                    max-width: 100%;
                    margin-right: auto;
                    @include ellipsis-oneliner;
                    font-size: 13px;
                    font-weight: 700;
                    color: $def-darkgrey;
                    @include transition(color $def-transition_duration);
                  }

                  textarea {
                    @include SourceCodeProWithFallback;
                    display: block;
                    width: 100%;
                    @include box-sizing(border-box);
                    border: $border;
                    @include border-radius($def-radius);
                    padding: 8px;
                    line-height: normal;
                    font-size: 12px;
                    font-weight: 500;
                    color: $def-darkgrey;
                    background-color: $def-ultralightgrey;

                    &:disabled {
                      color: inherit;
                    }
                  }

                  a {
                    color: #8151a8;
                    text-decoration: underline;
                  }

                  .always-run {
                    @include display-flex;

                    .icon {
                      width: 20px;
                      align-self: center;
                      line-height: 1;
                    }

                    span.icon svg {
                      @include size(9px, 16px);
                      fill: $def-grey;
                    }

                    label {
                      flex-grow: 1;
                      cursor: pointer;
                      font-weight: 700;
                      color: $def-darkgrey;
                    }

                    .checkbox {
                      align-self: end;
                    }
                  }
                }
              }

              section.inputs {

                h3 {
                  @include margin-y(0);
                  border-top: 3px solid $def-lightgrey;
                  @include padding-y(10px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;
                  font-size: 20px;
                  font-weight: 700;
                  color: $def-mediumdarkgrey;
                }

                $toggle_category_button_icon-width: 10px;

                ol.input-category {
                  @include margin-y(0);
                  padding-left: 0;

                  &:not(:last-child) {
                    border-bottom: $border;
                  }

                  &:not(.main) {
                    $margin: 10px;
                    $borderwidth: 1px;
                    overflow: hidden;
                    margin: $margin;
                    border-radius: 5px;
                    border: $borderwidth solid $def-mediumlightgrey;

                    ol.inputs-list li.input {
                      padding-left: $leftpadding - $borderwidth - $margin;
                    }
                  }

                  h4 {
                    @include display-flex;
                    @include justify-content(space-between);
                    position: relative;
                    @include margin-y(0);
                    @include padding-y(10px);
                    padding-left: $leftpadding;
                    padding-right: 6px + $toggle_category_button_icon-width + $rightpadding;
                    font-size: 13px;
                    color: $def-darkgrey;
                    background-color: $def-ultralightgrey;

                    strong.category-name {
                      @include ellipsis-oneliner;
                      font-weight: 700;
                    }

                    button.toggle-category {
                      @include position(absolute, 0, 0);
                      @include size(100%);

                      svg {
                        $toggle_category_button_icon-height: 10px;

                        @include position(absolute, 50%, $rightpadding);
                        @include size($toggle_category_button_icon-width, 10px);
                        margin-top: -$toggle_category_button_icon-height / 2;
                        fill: black;
                        @include transition(transform 0.3s, opacity $def-transition_duration);
                      }

                      &:not(:focus):not(:hover) svg {
                        opacity: 0.6;
                      }
                    }
                  }

                  &.open button.toggle-category svg {
                    @include transform(rotate(135deg));
                  }

                  ol.inputs-list {
                    @include margin-y(0);
                    padding-left: 0;
                    list-style: none;

                    li.input {
                      position: relative;
                      @include display-flex;
                      @include padding-y(20px);
                      padding-left: $leftpadding;
                      padding-right: $rightpadding;
                      border-top: 1px solid $def-mediumlightgrey;
                      color: $def-mediumdarkgrey;
                      @include transition(background-color $def-transition_duration);

                      &:before {
                        content: "";
                        @include position(absolute, 0, null, null, $leftpadding);
                        @include size(100%, 1px);
                      }

                      .input-info {
                        @include flex-grow(1);
                        overflow: hidden;

                        h5 {
                          @include display-flex;
                          @include align-items(center);
                          @include margin-y(0);

                          span.title {
                            display: block;
                            max-width: 100%;
                            margin-right: auto;
                            @include ellipsis-oneliner;
                            font-size: 13px;
                            font-weight: 700;
                            color: $def-darkgrey;
                            @include transition(color $def-transition_duration);

                            em {
                              font-style: normal;
                              color: white;
                              text-align: center;
                              white-space: nowrap;
                              vertical-align: baseline;
                              border-radius: 10rem;
                              display: inline-block;
                              padding: .25em 1em;
                              font-size: 75%;
                              font-weight: 500;
                              letter-spacing: 0.1em;
                              text-transform: uppercase;

                              &.required {
                                background: $def-purple;
                              }

                              &.sensitive {
                                background: $def-yellow;
                              }
                            }
                          }

                          button.insert-variable {
                            @include flex-shrink(0);
                            margin-left: 6px;
                          }
                        }

                        .input-description {
                          @include margin-y(6px);
                          font-size: 13px;
                          color: $def-mediumdarkgrey;
                        }

                        .flex-wrapper {
                          @include display-flex();
                          @include flex-direction(row);
                          @include align-items(flex-start);

                          textarea.has-button {
                            border-top-right-radius: 0px;
                            border-bottom-right-radius: 0px;
                            border-right: 0px;
                          }
                        }

                        textarea, select {
                          @include SourceCodeProWithFallback;
                          display: block;
                          width: 100%;
                          @include box-sizing(border-box);
                          border: $border;
                          @include border-radius($def-radius);
                          padding: 8px;
                          line-height: normal;
                          font-size: 12px;
                          font-weight: 500;
                          color: $def-darkgrey;
                          background-color: $def-ultralightgrey;

                          &:disabled {
                            color: inherit;
                          }
                        }

                        .sensitive-input-warning {
                          @include display-flex;
                          @include flex-direction(column);
                          padding-top: 15px;

                          span {
                            margin-bottom: 15px;
                            font-size: 13px;
                            color: $def-mediumdarkgrey;

                            button {
                              color: $def-purple;
                              text-decoration: underline;
                            }
                          }

                          button.insert-variable {
                            max-width: 160px;
                          }
                        }

                        .is-expand {
                          @include display-flex;
                          @include align-items(center);
                          margin-top: 12px;
                          font-size: 13px;
                          font-weight: 400;

                          p {
                            @include display-flex;
                            @include align-items(center);
                            @include margin-y(0);

                            svg {
                              @include flex-shrink(0);
                              margin-right: 6px;
                            }

                            &.expanded svg {
                              @include size(10px, 9px);
                              fill: $def-green;
                            }

                            &.not-expanded svg {
                              @include size(8px);
                              fill: $def-danger;
                            }
                          }

                          a.devcenter-info {
                            margin-left: 6px;
                            @include border-radius($def-radius);
                            padding: 3px 8px;
                            color: white;
                            background-color: $def-purple;
                            text-decoration: none;
                            @include transition(background-color $def-transition_duration);

                            &:before {
                              content: "?";
                            }

                            &:hover, &:focus {
                              background-color: $def-purple-shade;
                            }
                          }
                        }
                      }

                      .input-change {
                        $color: $def-grey;
                        $transition_duration: $def-transition_duration;

                        @include flex-shrink(0);
                        @include display-flex;
                        @include align-items(center);
                        padding-left: 10px;
                        font-size: 11px;
                        text-transform: uppercase;
                        color: $color;

                        button {
                          @include position(absolute, 0, 0);
                          @include size(100%);
                        }

                        span {
                          @include transition(color $transition_duration);
                        }

                        svg {
                          @include size(10px, 7px);
                          margin-left: 10px;
                          fill: $color;
                          @include transition(transform $transition_duration, fill $transition_duration);
                          pointer-events: none;
                        }

                        button:hover ~ span, button:focus ~ span {
                          color: black;
                        }

                        button:hover ~ svg, button:focus ~ svg {
                          fill: black;
                        }
                      }
                    }

                    li.input.selected {
                      background-color: white;

                      .input-info h4 span.title {
                        color: black;
                      }

                      .input-change {
                        position: relative;

                        span {
                          display: none;
                        }

                        svg {
                          @include transform(rotate(-180deg));
                        }
                      }
                    }

                    li.input.dont-change {
                      cursor: not-allowed;

                      .input-info h5 span.title {
                        color: inherit;
                      }

                      .input-change {
                        display: none;
                      }

                      * {
                        cursor: inherit;
                      }
                    }

                    li.input.required-empty {

                      .input-info textarea {
                        border-color: $def-danger;
                      }
                    }

                    li.input.sensitive {
                      cursor: not-allowed;

                      * {
                        cursor: inherit;
                      }

                      button.insert-variable, .input-change, a.devcenter-info, .sensitive-input-warning span button {
                        cursor: pointer;
                      }
                    }
                  }
                }

                @include media-below-big {

                  h3 {
                    @include padding-x($horizontalpadding_small);
                  }

                  ol.input-category {

                    h4 {
                      padding-left: $horizontalpadding_small;
                      padding-right: 6px + $toggle_category_button_icon-width + $horizontalpadding_small;

                      button.toggle-category svg {
                        right: $horizontalpadding_small;
                      }
                    }

                    ol.inputs-list > li.input {
                      @include padding-x($horizontalpadding_small);

                      &:before {
                        left: $horizontalpadding_small;
                      }

                      .input-info h5 {
                        @include flex-direction(column);
                        @include align-items(flex-start);

                        button.insert-variable {
                          @include align-self(flex-start);
                          margin-left: 0;
                          margin-top: 4px;
                        }
                      }
                    }
                  }
                }
              }

              section.outputs {

                h3 {
                  @include margin-y(0);
                  @include border-y($border);
                  @include padding-y(10px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;
                  font-size: 13px;
                  font-weight: 300;
                  color: $def-darkgrey;
                  background-color: $def-verylightgrey;
                }

                p.no-outputs {
                  @include margin-y(16px);
                  padding-left: $leftpadding;
                  padding-right: $rightpadding;
                  font-size: 13px;
                }

                .output-box {
                  $table_border: 1px solid $def-mediumlightgrey;

                  display: table;
                  table-layout: fixed;
                  width: 100%;
                  @include margin-y(0);
                  border-collapse: collapse;
                  padding-left: 0;
                  list-style: none;

                  .output {
                    display: table-row;
                    font-size: 13px;

                    .parameter {
                      display: table-cell;
                      width: 50%;
                      @include padding-y(12px);
                      padding-left: $leftpadding;
                      padding-right: $rightpadding;
                    }

                    .o {
                      display: block;
                    }

                    .key {

                      input {
                        width: 100%;
                        margin: 0;
                        border: none;
                        padding: 0;
                        font-size: 13px;
                        font-weight: 400;
                        color: $def-purple;
                      }
                    }

                    .description {
                      position: relative;
                      font-weight: 300;
                      color: $def-grey;

                      p {
                        @include margin-y(0);
                      }

                      button {
                        @include position(absolute, 0, 0);
                        @include size(100%);
                      }

                      .toggleabble-description {
                        @include display-flex;
                        @include align-items(center);
                        word-break: break-word;

                        p {
                          @include flex-grow(1);

                          pre {
                            white-space: normal;
                            word-break: break-all;
                          }
                        }

                        .toggle-arrow-button svg {
                          @include flex-shrink(0);
                          @include size(10px, 7px);
                          margin-left: 10px;
                          fill: $def-grey;
                          @include transition(fill $def-transition_duration, transform $def-transition_duration);
                        }

                        p:not(.oneliner) + .toggle-arrow-button svg {
                          @include transform(rotate(-180deg));
                        }
                      }

                      button:hover + .toggleabble-description, button:focus + .toggleabble-description {

                        .toggle-arrow-button svg {
                          fill: black;
                        }
                      }
                    }
                  }

                  .output:not(:first-child) {
                    border-top: $table_border;
                  }

                  .parameter:not(:first-child) {
                    border-left: $table_border;
                  }
                }

                @include media-below-big {

                  h3 {
                    @include padding-x($horizontalpadding_small);
                  }

                  p.no-outputs {
                    @include padding-x($horizontalpadding_small);
                  }

                  .output-box .output .parameter {
                    @include padding-x($horizontalpadding_small);
                  }
                }

                @include media-below-mid {

                  .output-box .output .parameter.description {
                    display: none;
                  }
                }
              }
            }

            button.delete-step {
              width: 100%;
              @include ellipsis-oneliner;
            }
          }
        }

        @include media-below-mid {
          @include padding-x($main-horizontalpadding_small);
        }

        @include media-below-big {

          header.workflow-header {

            .header-info {

              h2 {
                max-width: $steptitle-width_small;
              }
            }
          }

          article ul.steps li {

            button.add-step:last-child {
              margin-right: $spacing + $steptitle-width_small;
            }

            .step-actions {

              button.step span.info {
                width: $steptitle-width_small;
              }
            }
          }
        }

        @include media-below-mid {

          header.workflow-header {

            .header-info {
              display: block;

              h2 {
                overflow: hidden;
              }

              .stack {
                margin-left: 0;
                margin-top: 10px;

                .icon {
                  margin-left: 0;
                }
              }
            }
          }

          article ul.steps li {

            button.add-step:last-child {
              margin-right: 0;
            }

            .step-actions {

              button.step img.icon {
                position: static;
                display: block;
              }

              button.step span.info {
                display: none;
              }
            }
          }
        }

        @include media-below-small {

          article ul.steps li {

            button.add-step {
              width: $icon-size_small;
            }

            .step-actions {

              button.step img.icon {
                @include size($icon-size_small);
              }

              button.update-step {
                left: $icon-size_small;
              }
            }
          }
        }
      }

      section.workflow.selected {
        background-color: white;
      }

      section.workflow:not(.selected) {
        $inactive_opacity: 0.7;

        article {

          ul.steps {
            opacity: $inactive_opacity;
          }
        }
      }

      // Workflow chain arrow

      $arrow-width: 1px;
      $arrow_end-width: 15px;
      $arrow-color: $def-darkgrey;

      section.workflow {

        header.workflow-header {

          &.with-flow-decoration:before {
            content: "";
            @include flex-shrink(0);
            @include box-sizing(border-box);
            width: $arrow_end-width;
            @include margin-x(($icon-size - $arrow_end-width) / 2);
            @include padding-x(($arrow_end-width - $arrow-width) / 2);
            background-color: $arrow-color;
            background-clip: border-box, content-box;

            background-image: background_image_from_svg_content('<%= svg("arrow_slim-down") %>'), none;
            background-size: contain;
            background-position: center bottom;
            background-repeat: no-repeat;

            @include media-below-small {
              @include margin-x(($icon-size_small - $arrow_end-width) / 2);
            }
          }
        }

        article {

          ul.steps {

            &:after {
              content: "";
              @include flex-grow(1);
              @include box-sizing(border-box);
              width: $arrow_end-width;
              min-height: 30px;
              @include margin-x(($icon-size - $arrow_end-width) / 2);
              @include padding-x(($arrow_end-width - $arrow-width) / 2);
              background-color: $arrow-color;
              background-clip: content-box;

              @include media-below-small {
                @include margin-x(($icon-size_small - $arrow_end-width) / 2);
              }
            }
          }
        }
      }

      section.workflow:first-child {

        header.workflow-header {
          margin-top: 35px;

          &:before {
            border-top: $arrow-width solid $arrow-color;
            background-image: none, none;
          }

          h2 {
            margin-top: 0;
          }
        }
      }

      section.workflow:last-child {
        padding-bottom: 50px;

        article {

          ul.steps {

            &:after {
              border-bottom: $arrow-width solid $arrow-color;
            }
          }
        }
      }

      section.workflow.selected:not(:first-child) {

        header.workflow-header {

          .header-info {
            $negative_spacing: -15px;

            @include position(relative, $negative_spacing);

            .stack {
              @include position(relative, - $negative_spacing + 15px);

              @include media-below-mid {
                position: static;
              }
            }
          }
        }
      }

      section.workflow:not(.selected):not(:first-child) {

        header.workflow-header {

          h2 {
            margin-top: 20px;
          }
        }
      }
    }
  }
}

.popup-body#add-workflow-popup-body {
  width: 480px !important;

  article {

    input, select {
      display: block;
      @include box-sizing(border-box);
      width: 100%;
      @include border-radius($def-radius);
      border: 1px solid $def-mediumlightgrey;
      padding: 12px;
      font-size: 16px;
      font-weight: 300;
    }

    input {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
    }
  }
}

.popup-body#rearrange-workflow-chain-popup-body, .popup-body#add-run-workflow-popup-body {

  header {
    background-color: $def-ultralightgrey;
  }

  article {

    ul.workflow-chain {
      $icon-size: 12px;
      $workflow-padding: 8px;
      $fontsize: 14px;
      $color: $def-darkgrey;

      @include display-flex;
      @include flex-direction(column);
      @include margin-y(0);
      @include padding-y(30px);
      padding-left: 0;
      list-style: none;

      ul.workflow-subchain {
        $border: 1px solid $def-grey;

        border: $border;
        @include border-radius($def-radius);
        padding-left: 0;

        li {
          padding: $workflow-padding;
          padding-left: $workflow-padding + $icon-size + $workflow-padding;
          @include ellipsis-oneliner;
          font-size: $fontsize;
          font-weight: 300;
          background-repeat: no-repeat;
          background-position: left $workflow-padding center;
          color: $color;
        }

        li:not(:last-child) {
          border-bottom: 1px solid $def-grey;
        }
      }

      ul.workflow-subchain:empty {
        display: none;
      }

      ul.workflow-subchain.before-run, ul.workflow-subchain.after-run {
        background-color: $def-verylightgrey;
      }

      ul.workflow-subchain.before-run {

        li {
          background-image: background_image_from_svg_content('<%= svg("workflow/icon-before_run") %>');
          background-size: $icon-size auto;
        }
      }

      ul.workflow-subchain.after-run {

        li {
          background-image: background_image_from_svg_content('<%= svg("workflow/icon-after_run") %>');
          background-size: $icon-size auto;
        }
      }

      ul.workflow-subchain.selected {
        background-color: white;

        li {
          background-image: background_image_from_svg_content('<%= svg("workflow/icon-current") %>');
          background-size: $icon-size auto;
        }
      }

      ul.workflow-subchain.dragged-element {
        z-index: $zindex-dragged_element;
      }

      &[order-by-drag] ul.workflow-subchain {
        $drag_handle-reservedspace: 20px;

        margin-left: $drag_handle-reservedspace;
        cursor: move;

        &:before {
          @include position(absolute, 0, null, null, -$drag_handle-reservedspace);
          content: "";
          @include size($drag_handle-reservedspace, 100%);
          background-position: center;
          background-image: background_image_from_svg_content('<%= svg("drag_handle") %>');
          background-size: 4px auto;
          background-repeat: no-repeat;
        }
      }

      ul.workflow-subchain, select.run-workflow-selector {
        @include margin-y(5px);
      }

      select.run-workflow-selector {
        width: 100%;
        border: none;
        padding: $workflow-padding;
        padding-left: $workflow-padding + $icon-size + $workflow-padding;
        @include ellipsis-oneliner;
        font-size: $fontsize;
        font-weight: 300;
        background-repeat: no-repeat;
        background-position: left $workflow-padding center, right $workflow-padding center;
        background-color: $def-purple;
        color: white;
        @include transition(background-color $def-transition_duration);
      }

      select.run-workflow-selector:hover, select.run-workflow-selector:focus {
        background-color: $def-purple-shade;
      }

      select.run-workflow-selector.before-run {
        background-image: background_image_from_svg_content('<%= svg("workflow/icon-before_run_popup") %>'), background_image_from_svg_content('<%= svg("arrow-down") %>');
        background-size: $icon-size auto, 8px auto;
      }

      select.run-workflow-selector.after-run {
        background-image: background_image_from_svg_content('<%= svg("workflow/icon-before_run_popup") %>'), background_image_from_svg_content('<%= svg("arrow-down") %>');
        background-size: $icon-size auto, 8px auto;
      }
    }

    ul.workflow-chain.drag-in-progress {

      * {
        @include user-select(none);
      }
    }
  }

  footer {
    @include flex-shrink(0);
    @include display-flex;

    button {
      width: 50%;
      border-top: 1px solid;
      @include padding-y(18px);
      font-size: 16px;
      font-weight: 300;
      color: white;
      @include transition(border-color $def-transition_duration, background-color $def-transition_duration);
    }

    button.done {
      border-color: $def-purple;
      background-color: $def-purple;
    }

    button.done:hover, button.done:focus {
      border-color: $def-purple-shade;
      background-color: $def-purple-shade;
    }

    button.cancel {
      border-color: $def-lightgrey;
      color: $def-verydarkgrey;
    }

    button.cancel:hover, button.cancel:focus {
      background-color: $def-ultralightgrey;
    }
  }
}

.popup-body#add-run-workflow-popup-body {

  ul.workflow-subchain.before-run {
    @include order(1);
  }

  select.run-workflow-selector.before-run {
    @include order(2);
  }

  ul.workflow-subchain.selected {
    @include order(3);
  }

  select.run-workflow-selector.after-run {
    @include order(5);
  }

  ul.workflow-subchain.after-run {
    @include order(5);
  }
}

.popup-body#insert-variable-popup-body {

  header {
    h2 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: inherit;
      font-weight: inherit;
    }

    input {
      $searchicon_width: 16px;
      $padding: 12px;
      display: block;
      @include box-sizing(border-box);
      width: 100%;
      border: none;
      @include border-radius($def-radius);
      padding: $padding;
      padding-left: $padding + $searchicon_width + $padding;
      font-size: 16px;
      font-weight: 300;
      background-color: $def-verylightgrey;
      background-image: background_image_from_svg_content('<%= svg("search") %>');
      background-size: $searchicon_width auto;
      background-repeat: no-repeat;
      background-position: left $padding center;
    }
  }

  article {

    .create-new-secret, .list-of-available-secrets, .list-of-available-env-vars {
      margin-bottom: 18px;

      .title {
        font-size: 19px;
        font-weight: bold;
        font-style: normal;
        font-stretch: normal;
        line-height: 1.26;
        letter-spacing: 0.2px;
        color: $def-purple-shade;
        padding-bottom: 18px;
        margin-bottom: 15px;
        border-bottom: 2px solid $def-mediumlightgrey;
      }

      input.searchbar {
        $searchicon_width: 16px;
        $padding: 12px;

        display: block;
        @include box-sizing(border-box);
        width: 100%;
        border: none;
        @include border-radius($def-radius);
        padding: $padding;
        padding-left: $padding + $searchicon_width + $padding;
        margin-bottom: 12px;
        font-size: 16px;
        font-weight: 300;
        background-color: $def-verylightgrey;
        background-image: background_image_from_svg_content('<%= svg("search") %>');
        background-size: $searchicon_width auto;
        background-repeat: no-repeat;
        background-position: left $padding center;
      }

      ul.variable-source {
        @include margin-y(0);
        padding-left: 0;
        list-style: none;

        li {
          margin-bottom: 5px;

          button {
            display: block;
            @include box-sizing(border-box);
            width: 100%;
            border: 1px solid $def-lightgrey;
            @include border-radius($def-radius);
            padding: 10px 14px;
            text-align: left;
            @include transition(background-color $def-transition_duration);

            strong {
              display: block;
              margin-bottom: 4px;
              @include ellipsis-oneliner;
              font-size: 13px;
              font-weight: 400;
              color: $def-purple;
            }

            em {
              display: block;
              @include ellipsis-oneliner;
              font-size: 11px;
              font-weight: 300;
              font-style: normal;
              text-transform: uppercase;
              color: $def-grey;
            }
          }

          button:hover, button:focus {
            background-color: $def-lightgrey;
          }
        }

        &:last-child li:last-child {
          margin-bottom: 0;
        }
      }

      form {
        $input-height: 36px;
        $input-horizontalpadding: 14px;
        $first_column-width: 240px;
        $action_dropdown_icon-spacing: 15px;
        $action_dropdown_icon-width: 26px;
        padding-top: $cardo-verticalpadding;
        padding-bottom: $cardo-verticalpadding;
        background-color: white;

        .key-value-delete {
          @include display-flex;
          @include align-items(center);
          margin-bottom: 12px;

          &:before {
            content: "=";
            @include order(2);
            @include margin-x(20px);
            width: 10px;
            font-size: 16px;
            font-weight: 900;
          }

          input.key, textarea.value {
            padding: 0px $input-horizontalpadding;
            height: $input-height;
            font-size: 14px;
            font-weight: 200;
            @include SourceCodeProWithFallback;
          }

          input.key {
            $background_width: 8px;
            $background_reservedwidth: 30px;

            @mixin input_key_styling($is_danger) {
              $color: if($is_danger, $def-danger, $def-purple);

              border: 1px solid $color;
              color: $color;
              background-image: background_image_from_svg_content('<%= svg("env_var_prefix") %>'), background_image_from_svg_content('<svg xmlns="http://www.w3.org/2000/svg"><rect width="#{ $background_reservedwidth }" height="#{ $input-height }" fill="#{ rgba($color, 0.99) }"></rect></svg>');
            }

            @include order(1);
            @include flex-shrink(0);
            @include box-sizing(border-box);
            width: $first_column-width;
            @include border-radius($def-radius);
            padding-left: $background_reservedwidth + $input-horizontalpadding;
            background-size: $background_width auto, $background_reservedwidth 100%;
            background-position: left #{($background_reservedwidth - $background_width) / 2} center, left center;
            background-repeat: no-repeat;
            @include input_key_styling(false);

            &.ng-invalid:not(.ng-pristine) {
              @include input_key_styling(true);
            }

            &:disabled {
              opacity: 0.5;
            }
          }

          .value-with-actions.secret {
            @include order(3);
            @include flex-grow(1);
            @include align-self(flex-start);
            border: 1px solid $def-mediumlightgrey;
            @include border-radius($def-radius);
            position: relative;

            textarea.value {
              @include align-self(stretch);
              @include box-sizing(border-box);
              border: 0;
              @include padding-y(8px);
              display: block;
              width: 100%;
              padding-right: 68px;

              &.protected {
                padding-right: 14px;
                color: $def-mediumdarkgrey;
                background-color: $def-lightgrey;
              }
            }
          }
        }

        .env-var-settings {
          @include display-flex;
          @include align-items(center);

          &:not(:last-child) {
            margin-bottom: 12px;
          }

          .is-expand, .is-expose-with-popover {
            @include display-flex;
            @include align-items(center);

            .checkbox + label {
              margin-left: 8px;
            }

            label {
              font-size: 13px;
              font-weight: 300;
            }
          }

          .is-expand {
            @include flex-shrink(0);
            @include box-sizing(border-box);
            width: $first_column-width + 50px;
          }

          .is-expose-with-popover {
            @include flex-grow(1);
            @include align-self(stretch);
            @include box-sizing(border-box);

            .is-expose {
              @include display-flex;
              position: relative;

              .popover {
                top: 85%;
              }
            }
          }
        }

        p.notification {
          margin-top: 0;
          margin-bottom: 12px;
        }

        @include media-below-mid {

          .key-value-delete {
            @include flex-direction(column);
            @include align-items(flex-start);

            &:before {
              @include margin-y(10px);
              @include margin-x(auto);
            }

            input.key, .value-with-actions {
              width: 100%;
            }
          }

          .env-var-settings {
            @include flex_direction(column);
            @include align-items(flex-start);

            .is-expand, .is-expose-with-popover {
              @include padding-y(12px);
            }

            .is-expose-with-popover .is-expose .popover {
              top: 95%;
            }
          }
        }
      }
    }

    .create-new-secret {
      margin-bottom: 30px;
    }
  }
}
